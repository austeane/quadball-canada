---
import Layout from "@/layouts/Layout.astro";
import type { Locale } from "@/utils/localization";
import { getLandingSection } from "@/utils/sanity";

interface Props {
  locale: Locale;
}

const { locale } = Astro.props as Props;
const isFr = locale === "fr";

// Fetch landing section content from Sanity
const landingSection = await getLandingSection("about", locale);

// Fallback content if Sanity data is not available
const fallbackContent = isFr
  ? {
      layoutTitle: "À propos — Quadball Canada",
      heading: "À propos",
      intro: "Découvrez notre mission, rencontrez notre équipe et apprenez-en plus sur le quadball au Canada.",
      cards: [],
    }
  : {
      layoutTitle: "About — Quadball Canada",
      heading: "About Us",
      intro: "Learn about our mission, meet our team, and discover more about quadball in Canada.",
      cards: [],
    };

const content = landingSection
  ? {
      layoutTitle: `${landingSection.title} — Quadball Canada`,
      heading: landingSection.title,
      intro: landingSection.intro,
      cards: landingSection.cards,
    }
  : fallbackContent;

const alternate = {
  en: "/about/",
  fr: "/fr/a-propos/",
};
---

<Layout title={content.layoutTitle} alternate={alternate} locale={locale}>
  <section class="section">
    <header class="intro">
      <h1>{content.heading}</h1>
      <p>{content.intro}</p>
    </header>

    {content.cards && content.cards.length > 0 && (
      <div class="grid">
        {content.cards.map((card) => (
          <article>
            <h2>{card.title}</h2>
            <p>{card.body}</p>
            <a
              class="btn"
              href={card.href}
              target={card.external ? "_blank" : undefined}
              rel={card.external ? "noopener noreferrer" : undefined}
            >
              {card.ctaText}
              {card.external && " →"}
            </a>
          </article>
        ))}
      </div>
    )}
  </section>
</Layout>

<style>
  .section {
    padding: 3rem 0;
    display: flex;
    flex-direction: column;
    gap: 3rem;
  }
  .intro {
    max-width: 720px;
  }
  .grid {
    display: grid;
    gap: 2rem;
  }
  article {
    padding: 2rem;
    border-radius: 12px;
    background: var(--bg-secondary, #f8f9fa);
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }
  .btn {
    display: inline-block;
    border-radius: 999px;
    font-weight: 700;
    padding: 0.8rem 1.6rem;
    text-decoration: none;
    background: var(--brand-primary);
    color: #fff;
  }
  .btn:hover {
    background: var(--brand-ink);
  }
  @media (min-width: 768px) {
    .grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }
  @media (min-width: 1024px) {
    .grid {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }
</style>