---
import Layout from "@/layouts/Layout.astro";
import PageHero from "@/components/sections/PageHero.astro";
import type { Locale } from "@/utils/localization";
import { getLandingSection, getPageSettings } from "@/utils/sanity";

interface Props {
  locale: Locale;
}

const { locale } = Astro.props as Props;
const isFr = locale === "fr";

// Fetch landing section content from Sanity
const landingSection = await getLandingSection("getInvolved", locale);
const pageSettings = await getPageSettings();

// Fallback content if Sanity data is not available
const fallbackContent = isFr
  ? {
      layoutTitle: "S'impliquer — Quadball Canada",
      heading: "S'impliquer",
      intro: "Rejoignez la communauté de quadball au Canada. Que vous souhaitiez jouer, bénévoler, ou organiser des activités, un parcours est prêt pour vous.",
      cards: [],
    }
  : {
      layoutTitle: "Get Involved — Quadball Canada",
      heading: "Get Involved",
      intro: "Join the growing quadball community in Canada. Whether you want to play, volunteer, or host programming, there is a pathway ready for you.",
      cards: [],
    };

const content = landingSection
  ? {
      layoutTitle: `${landingSection.title} — Quadball Canada`,
      heading: landingSection.title,
      intro: landingSection.intro,
      cards: landingSection.cards,
    }
  : fallbackContent;

const alternate = {
  en: "/get-involved/",
  fr: "/fr/simpliquer/",
};
---

<Layout title={content.layoutTitle} alternate={alternate} locale={locale}>
  <PageHero
    title={content.heading}
    subtitle={content.intro}
    image={pageSettings?.getInvolvedHeroImage ?? pageSettings?.defaultHeroImage}
  />
  <section class="section">
    {content.cards && content.cards.length > 0 && (
      <div class="grid">
        {content.cards.map((card) => (
          <article>
            <h2>{card.title}</h2>
            <p>{card.body}</p>
            <a
              class="btn"
              href={card.href}
              target={card.external ? "_blank" : undefined}
              rel={card.external ? "noopener noreferrer" : undefined}
            >
              {card.ctaText}
              {card.external && " →"}
            </a>
          </article>
        ))}
      </div>
    )}
  </section>
</Layout>

<style>
  .section {
    padding: 3rem 0;
    display: flex;
    flex-direction: column;
    gap: 3rem;
  }
  .grid {
    display: grid;
    gap: 2rem;
  }
  article {
    padding: 2rem;
    border-radius: 12px;
    background: var(--bg-secondary, #f8f9fa);
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }
  .btn {
    display: inline-block;
    border-radius: 999px;
    font-weight: 700;
    padding: 0.8rem 1.6rem;
    text-decoration: none;
    background: var(--brand-primary);
    color: #fff;
  }
  .btn:hover {
    background: var(--brand-ink);
  }
  @media (min-width: 768px) {
    .grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }
</style>
