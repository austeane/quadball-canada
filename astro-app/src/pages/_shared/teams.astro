---
import { PortableText } from "astro-portabletext";
import Layout from "@/layouts/Layout.astro";
import { getTeams, getTeamsPage } from "@/utils/sanity";
import TeamLevels from "@/components/team/TeamLevels.astro";
import TeamSections from "@/components/team/TeamSections.astro";
import type { Locale } from "@/utils/localization";

interface Props {
  locale: Locale;
}

const { locale } = Astro.props as Props;
const [teams, teamsPage] = await Promise.all([getTeams(locale), getTeamsPage(locale)]);

const isFr = locale === "fr";

const fallbackIntro = isFr
  ? "Les communautes de quadball au Canada offrent des options recreatives, competitives, jeunesse et nationales. Parcourez le repertoire ci-dessous pour trouver le programme qui vous convient."
  : "Quadball communities across Canada offer youth, recreational, competitive, and national pathways. Explore the directory below to find the best fit and connect with organizers in your area.";

const fallbackCta = isFr
  ? {
      heading: "Parlez-nous de vos objectifs et de votre localisation",
      body:
        "Dites-nous ce que vous recherchez et nous vous aiderons a rejoindre le programme le plus proche ou a en demarrer un nouveau.",
      buttonLabel: "Communiquer avec Quadball Canada",
      buttonHref: "/fr/contact/",
    }
  : {
      heading: "Tell us about your goals and location",
      body:
        "Share what you are looking for and we will help you connect with the closest program or launch something new.",
      buttonLabel: "Connect with Quadball Canada",
      buttonHref: "/contact/",
    };

const levelSections = teamsPage?.levels ?? [];
const introBlocks = teamsPage?.intro ?? [];
const pageTitle = teamsPage?.title ?? (isFr ? "Equipes" : "Teams");
const cta = teamsPage?.cta ?? null;

const ctaHeading = cta?.heading ?? fallbackCta.heading;
const ctaBody = cta?.body ?? fallbackCta.body;
const ctaLabel = cta?.buttonLabel ?? fallbackCta.buttonLabel;
const ctaHref = cta?.buttonHref ?? fallbackCta.buttonHref;

const alternate = {
  en: "/teams/",
  fr: "/fr/equipes/",
};
---

<Layout title={pageTitle} alternate={alternate} locale={locale}>
  <section class="teams">
    <header class="teams__intro">
      <h1>{pageTitle}</h1>
      {introBlocks.length ? (
        <div class="teams__intro-content">
          <PortableText value={introBlocks} />
        </div>
      ) : (
        <p>{fallbackIntro}</p>
      )}
    </header>

    <TeamLevels levels={levelSections} locale={locale} />

    <TeamSections teams={teams} locale={locale} levels={levelSections} />

    {(ctaHeading || ctaBody || (ctaHref && ctaLabel)) && (
      <section class="teams__cta">
        {ctaHeading && <h2>{ctaHeading}</h2>}
        {ctaBody && <p>{ctaBody}</p>}
        {ctaHref && ctaLabel && (
          <a class="teams__cta-btn" href={ctaHref}>{ctaLabel}</a>
        )}
      </section>
    )}
  </section>
</Layout>

<style>
  .teams {
    padding: 3rem 0;
    display: grid;
    gap: 3rem;
  }

  .teams__intro {
    display: grid;
    gap: 1rem;
    max-width: 720px;
  }

  .teams__intro h1 {
    margin: 0;
  }

  .teams__intro-content :global(p) {
    margin: 0;
  }

  .teams__cta {
    text-align: center;
    padding: 2.5rem 1.5rem;
    border-radius: 1.25rem;
    background: var(--brand-tint);
    display: grid;
    gap: 1rem;
    max-width: 720px;
    margin: 0 auto;
  }

  .teams__cta h2 {
    margin: 0;
  }

  .teams__cta p {
    margin: 0 auto;
    max-width: 48ch;
  }

  .teams__cta-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.85rem 1.75rem;
    border-radius: 999px;
    font-weight: 700;
    background: var(--brand-primary);
    color: #fff;
    text-decoration: none;
  }

  .teams__cta-btn:hover {
    background: var(--brand-ink);
  }
</style>
