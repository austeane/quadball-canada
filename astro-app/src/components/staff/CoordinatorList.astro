---
import { urlFor } from "../../utils/image";
import type { StaffCoordinator } from "../../utils/sanity";

interface Props {
  coordinators: StaffCoordinator[];
  heading?: string;
}

const { coordinators, heading = "Coordinators" } = Astro.props as Props;

function getInitials(name: string) {
  const parts = name.trim().split(/\s+/);
  if (parts.length === 0) return "";
  if (parts.length === 1) return parts[0][0]?.toUpperCase() ?? "";
  return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
}
---

{coordinators.length > 0 && (
  <div class="coordinator-section">
    <h3 class="coordinator-heading">{heading}</h3>
    <div class="coordinator-grid">
      {coordinators.map((coord) => {
        const imageUrl = coord.headshot?.asset
          ? urlFor(coord.headshot).width(320).height(320).fit("crop").url()
          : null;
        const altText = coord.headshot?.alt ?? `${coord.name} headshot`;
        return (
          <article class="coordinator" data-id={coord._id}>
            <div class="media">
              {imageUrl ? (
                <img src={imageUrl} alt={altText} loading="lazy" />
              ) : (
                <div class="placeholder" aria-hidden="true">
                  {getInitials(coord.name)}
                </div>
              )}
            </div>
            <div class="details">
              <p class="name">{coord.name}</p>
              <p class="role">{coord.role}</p>
            </div>
          </article>
        );
      })}
    </div>
  </div>
)}

<style>
  .coordinator-section {
    margin-top: 1.5rem;
  }

  .coordinator-heading {
    font-size: var(--font-size-4);
    font-family: var(--font-family-sans);
    margin-bottom: 1rem;
  }

  .coordinator-grid {
    display: grid;
    gap: 1rem;
  }

  .coordinator {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 1rem;
    align-items: center;
    padding: 1rem;
    border: 1px solid var(--border);
    border-radius: 12px;
    background: #fff;
  }

  .media {
    width: 80px;
    height: 80px;
  }

  .media img,
  .placeholder {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    background: var(--brand-tint);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--brand-ink);
    font-weight: 700;
    font-size: var(--font-size-5);
  }

  .details {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .name {
    font-weight: 700;
    font-size: var(--font-size-4);
    margin: 0;
  }

  .role {
    margin: 0;
    color: var(--text);
  }

  @media (min-width: 768px) {
    .coordinator-grid {
      gap: 1.25rem;
    }
    .coordinator {
      padding: 1.25rem;
    }
    .media {
      width: 96px;
      height: 96px;
    }
  }
</style>
