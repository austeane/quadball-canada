---
import LanguageSwitcher from "./LanguageSwitcher.astro";

interface Props {
  currentPath: string;
  alternate?: { en: string; fr: string };
}

const { currentPath, alternate } = Astro.props as Props;

const navItems = [
  { href: "/news/", label: "Announcements" },
  { href: "/about/", label: "About Us" },
  { href: "/contact/", label: "Contact" },
  { href: "/events/", label: "Events" },
  { href: "/get-involved/", label: "Get Involved" },
];

// Split nav items for desktop centered layout
const leftNavItems = navItems.slice(0, Math.ceil(navItems.length/2));
const rightNavItems = navItems.slice(Math.ceil(navItems.length/2));

function isActive(href: string) {
  if (!currentPath) return false;
  return currentPath === href || currentPath.startsWith(href);
}
---
<header class="site-header">
  <div class="site-header__bar">
    <!-- Mobile menu drawer -->
    <details class="drawer">
      <summary class="nav-toggle">
        <span class="nav-toggle__icon">
          <span></span>
          <span></span>
          <span></span>
        </span>
        <span class="sr-only">Menu</span>
      </summary>
      <nav id="site-nav-mobile" class="drawer__panel" aria-label="Primary">
        {navItems.map((item) => (
          <a href={item.href} aria-current={isActive(item.href) ? "page" : undefined}>{item.label}</a>
        ))}
        <div class="drawer__actions">
          <a class="btn btn--secondary" href="https://www.vcultimate.com/" target="_blank" rel="noopener">Store</a>
          <a class="btn btn--primary" href="https://www.paypal.me/quidditchcanada" target="_blank" rel="noopener">Donate</a>
        </div>
        <div class="drawer__lang">
          <LanguageSwitcher currentPath={currentPath} alternate={alternate} />
        </div>
      </nav>
    </details>

    <!-- Desktop left nav -->
    <nav class="site-header__nav site-header__nav--left" aria-label="Primary left">
      {leftNavItems.map((item) => (
        <a href={item.href} aria-current={isActive(item.href) ? "page" : undefined}>{item.label}</a>
      ))}
    </nav>

    <!-- Centered logo -->
    <a class="site-header__title" href="/" aria-label="Quadball Canada â€” Home">
      <img src="/quadball-canada-logo.jpg" alt="Quadball Canada" class="logo" />
    </a>

    <!-- Desktop right nav -->
    <nav class="site-header__nav site-header__nav--right" aria-label="Primary right">
      {rightNavItems.map((item) => (
        <a href={item.href} aria-current={isActive(item.href) ? "page" : undefined}>{item.label}</a>
      ))}
      <a class="btn btn--secondary" href="https://www.vcultimate.com/" target="_blank" rel="noopener">Store</a>
      <a class="btn btn--primary" href="https://www.paypal.me/quidditchcanada" target="_blank" rel="noopener">Donate</a>
      <LanguageSwitcher currentPath={currentPath} alternate={alternate} />
    </nav>
  </div>
</header>

<style>
  .site-header {
    position: sticky;
    top: 0;
    z-index: 40;
    backdrop-filter: saturate(140%) blur(8px);
    background: color-mix(in oklab, var(--bg) 85%, white 15%);
    border-bottom: 1px solid var(--border);
  }

  .site-header__bar {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 24px;
    padding: 16px 0;
  }

  .site-header__title {
    display: inline-flex;
    align-items: center;
    justify-self: center;
    text-decoration: none;
  }

  .logo {
    height: 42px;
    width: auto;
    display: block;
  }

  .site-header__nav {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .site-header__nav--left {
    justify-content: flex-end;
  }

  .site-header__nav--right {
    justify-content: flex-start;
  }

  .site-header__nav a {
    color: var(--text-strong);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.95rem;
    transition: color 0.2s ease;
  }

  .site-header__nav a:hover {
    color: var(--brand-primary);
  }

  .site-header__nav a[aria-current="page"] {
    color: var(--brand-primary);
  }

  .btn {
    display: inline-block;
    padding: 0.6rem 1.1rem;
    border-radius: 8px;
    text-decoration: none !important;
    font-weight: 700;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .btn--primary {
    background: var(--brand-primary);
    color: #fff !important;
    box-shadow: 0 1px 3px rgba(0,0,0,.12);
  }

  .btn--primary:hover {
    background: var(--brand-ink);
    transform: translateY(-1px);
    box-shadow: 0 2px 6px rgba(0,0,0,.16);
  }

  .btn--secondary {
    background: #fff;
    border: 1px solid var(--border);
    color: var(--text-strong) !important;
  }

  .btn--secondary:hover {
    border-color: var(--brand-primary);
    color: var(--brand-primary) !important;
  }

  /* Mobile drawer */
  .drawer {
    display: none;
  }

  .nav-toggle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: #fff;
    cursor: pointer;
    list-style: none;
  }

  .nav-toggle::-webkit-details-marker {
    display: none;
  }

  .nav-toggle__icon {
    display: flex;
    flex-direction: column;
    gap: 3px;
    width: 18px;
  }

  .nav-toggle__icon span {
    height: 2px;
    background: var(--text-strong);
    border-radius: 1px;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }

  .drawer[open] .nav-toggle__icon span:nth-child(1) {
    transform: translateY(5px) rotate(45deg);
  }

  .drawer[open] .nav-toggle__icon span:nth-child(2) {
    opacity: 0;
  }

  .drawer[open] .nav-toggle__icon span:nth-child(3) {
    transform: translateY(-5px) rotate(-45deg);
  }

  .drawer__panel {
    position: absolute;
    left: 0;
    right: 0;
    top: 100%;
    padding: 20px;
    background: #fff;
    border-bottom: 1px solid var(--border);
    box-shadow: 0 4px 12px rgba(0,0,0,.08);
  }

  .drawer__panel a {
    display: block;
    padding: 12px 0;
    color: var(--text-strong);
    text-decoration: none;
    font-weight: 600;
    border-bottom: 1px solid var(--border);
  }

  .drawer__panel a:hover {
    color: var(--brand-primary);
  }

  .drawer__panel a[aria-current="page"] {
    color: var(--brand-primary);
  }

  .drawer__actions {
    display: flex;
    gap: 12px;
    margin-top: 20px;
  }

  .drawer__actions .btn {
    flex: 1;
    text-align: center;
  }

  .drawer__lang {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0,0,0,0);
    white-space: nowrap;
    border: 0;
  }

  @media (max-width: 1024px) {
    .site-header__bar {
      grid-template-columns: auto 1fr;
    }

    .site-header__nav--left,
    .site-header__nav--right {
      display: none;
    }

    .drawer {
      display: block;
      justify-self: start;
    }

    .site-header__title {
      justify-self: center;
      margin-right: 40px; /* Balance against menu button */
    }
  }

  @media (max-width: 480px) {
    .logo {
      height: 36px;
    }
  }
</style>
