---
import { formatDate } from "../../utils";
import { urlFor } from "../../utils/image";
import type { NewsArticleSummary } from "../../utils/sanity";
import type { Locale } from "../../utils/localization";

interface Props {
  article: NewsArticleSummary;
  locale?: Locale;
  featured?: boolean;
}

const { article, locale = "en", featured = false } = Astro.props as Props;
const basePath = locale === "fr" ? "/fr/nouvelles/" : "/news/";
const featuredImage = article.featuredImage;
---

<article class:list={["card", { "card--featured": featured }]}>
  <a href={`${basePath}${article.slug}/`} class="card__image-link">
    {featuredImage ? (
      <img
        class="card__cover"
        src={urlFor(featuredImage).width(featured ? 900 : 600).height(featured ? 500 : 360).auto('format').url()}
        srcset={`${urlFor(featuredImage).width(400).height(240).auto('format').url()} 400w,\n               ${urlFor(featuredImage).width(600).height(360).auto('format').url()} 600w,\n               ${urlFor(featuredImage).width(900).height(540).auto('format').url()} 900w`}
        sizes={featured ? "(max-width: 800px) 100vw, 900px" : "(max-width: 800px) 100vw, 366px"}
        width={featured ? "900" : "600"} height={featured ? "500" : "360"} loading="lazy" decoding="async"
        alt={featuredImage.alt || ""}
      />
    ) : <div class="card__cover--none" aria-hidden="true" />}
  </a>
  <div class="card__container">
    <h3 class="card__title">
      <a
        class="card__link"
        href={`${basePath}${article.slug}/`}
      >
        {article.title}
      </a>
    </h3>
    {article.excerpt && <p class="card__excerpt">{article.excerpt}</p>}
    <p class="card__date">
      {formatDate(article.publishedAt)}
    </p>
  </div>
</article>

<style>
  .card {
    display: flex;
    flex-direction: row;
    padding: var(--space-2);
    position: relative;
    border-bottom: 1px solid #ced2d9;
    transition: box-shadow 0.2s ease, transform 0.2s ease;
    gap: var(--space-3);

    & .card__image-link {
      display: block;
      overflow: hidden;
      border-radius: 8px;
      flex-shrink: 0;
    }

    & .card__container {
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    & .card__cover,
    & .card__cover--none {
      width: 120px;
      height: 120px;
      aspect-ratio: 1 / 1;
      object-fit: cover;
      border-radius: 8px;
      transition: transform 0.3s ease;
    }

    & .card__cover--none {
      background: linear-gradient(135deg,
        color-mix(in oklab, var(--brand-primary) 80%, black) 0%,
        var(--brand-primary) 50%,
        color-mix(in oklab, var(--brand-primary) 70%, white) 100%
      );
    }

    & .card__image-link:hover .card__cover {
      transform: scale(1.03);
    }

    & .card__title {
      font-family: var(--font-family-sans);
      font-weight: 800;
      font-size: var(--font-size-5);
      line-height: var(--line-height-5);
      margin: 0 0 var(--space-1) 0;
    }

    & .card__excerpt {
      font-family: var(--font-family-serif);
      font-weight: 400;
      font-size: var(--font-size-4);
      line-height: var(--line-height-3);
      margin-top: 0;
    }

    & .card__date {
      font-weight: 600;
      font-family: var(--font-family-sans);
      font-size: var(--font-size-1);
      margin-top: var(--space-2);
      color: var(--gray-600);
    }

    & .card__link { color: var(--brand-primary); text-decoration: none; }
    & .card__title a:hover { text-decoration: underline; }

    &:first-child {
      border-top-left-radius: 3px;
      border-top-right-radius: 3px;
    }

    &:last-child {
      border-bottom-left-radius: 3px;
      border-bottom-right-radius: 3px;
    }
  }

  /* Featured card styling */
  .card--featured {
    padding: var(--space-3);
    border: 1px solid #ced2d9;
    border-radius: 12px;
    background: var(--bg-secondary, #f8f9fa);

    & .card__cover,
    & .card__cover--none {
      aspect-ratio: 16 / 9;
      border-radius: 8px;
      max-height: 300px;
    }

    & .card__title {
      font-size: var(--font-size-6);
      line-height: var(--line-height-5);
    }

    & .card__excerpt {
      font-size: var(--font-size-4);
      line-height: var(--line-height-3);
    }
  }

  @media (min-width: 480px) {
    .card:not(.card--featured) {
      & .card__cover,
      & .card__cover--none {
        width: 160px;
        height: 160px;
      }
    }
  }

  @media (min-width: 575px) {
    .card:not(.card--featured) {
      border: 1px solid #ced2d9;
      border-bottom: none;

      &:last-child {
        border-bottom: 1px solid #ced2d9;
      }

      & .card__cover,
      & .card__cover--none {
        width: 180px;
        height: 180px;
      }
    }
  }

  @media (min-width: 800px) {
    .card:not(.card--featured) {
      & .card__cover,
      & .card__cover--none {
        width: 200px;
        height: 200px;
      }
    }

    .card--featured {
      & .card__cover,
      & .card__cover--none {
        max-height: 350px;
      }

      & .card__title {
        font-size: var(--font-size-7);
        line-height: var(--line-height-6);
      }
    }
  }
</style>
